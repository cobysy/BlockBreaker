!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/js",o(o.s=14)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(8),i=o(9),r=function(){function t(t,e,o,n){if(this.ax=t,this.ay=e,this.bx=o,this.by=n,t>=o||e>=n)throw new Error("IllegalArgument")}return t.getCornerCollisionState=function(t,e){return new n.CornerCollisionState(e.contains(t.ax,t.ay),e.contains(t.bx,t.ay),e.contains(t.ax,t.by),e.contains(t.bx,t.by))},t.getEightPointsCollisionState=function(t,e){var o=Math.trunc((t.ax+t.bx)/2),n=Math.trunc((t.ay+t.by)/2);return new i.EightPointsCollisionState(e.contains(t.ax,t.ay),e.contains(t.bx,t.ay),e.contains(t.ax,t.by),e.contains(t.bx,t.by),e.contains(o,t.ay),e.contains(o,t.by),e.contains(t.ax,n),e.contains(t.by,n))},t.whereCollisionAt=function(e,o){return t.getCornerCollisionState(e,o).whereCollisionAt()},t.prototype.collision=function(t){return this.ax<t.bx&&t.ax<this.bx&&this.ay<t.by&&t.ay<this.by},t.prototype.contains=function(t,e){return t>=this.ax&&e>=this.ay&&t<=this.bx&&e<=this.by},t}();e.RectBounds=r,function(t){t[t.NIL=0]="NIL",t[t.TOP=1]="TOP",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t[t.RIGHT_TOP=5]="RIGHT_TOP",t[t.RIGHT_BOTTOM=6]="RIGHT_BOTTOM",t[t.LEFT_TOP=7]="LEFT_TOP",t[t.LEFT_BOTTOM=8]="LEFT_BOTTOM"}(e.Location||(e.Location={}))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.x=0,this.y=0,this.vanished=!1,this.visible=!0}return t.update=function(t){try{t.slice().forEach(function(e,o){e.vanished?t.splice(o,1):e.update(1)})}catch(t){console.error(t)}},t.draw=function(t,e){t.slice().forEach(function(o,n){try{o.vanished?t.splice(n,1):o.visible&&o.draw(e)}catch(t){console.error(t)}})},t.prototype.isVanished=function(){return this.vanished},t.prototype.vanish=function(){this.vanished=!0,this.visible=!1},t.prototype.isVisible=function(){return this.visible},t.prototype.setVisible=function(t){this.visible=t},t.prototype.getX=function(){return this.x},t.prototype.setX=function(t){this.x=t},t.prototype.addX=function(t){return this.x+=t},t.prototype.getY=function(){return this.y},t.prototype.setY=function(t){this.y=t},t.prototype.addY=function(t){return this.y+=t},t}();e.Sprite=n},function(t,e,o){"use strict";var n=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new o(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(3),s=o(4),a=o(11),c=o(7),u=o(12),l=o(13),h=function(){function t(){this.runChecker=t.RUNCHECK_INTERVAL,this.getTimestamp=function(){return 0},this.gameState=new c.GameState}return t.main=function(){var e=this,o=new t;n(e,void 0,void 0,function(){return i(this,function(t){return o.run(),[2]})})},t.checkImage=function(t){return new Promise(function(e){var o=new Image;o.onload=function(){return e(o)},o.src=t})},t.prototype.initResources=function(){return console.log("Game static init"),new Promise(function(e){Promise.all([t.RESOURCE+"ball.png",t.RESOURCE+"block-dark.png",t.RESOURCE+"bonusPanel.png",t.RESOURCE+"hexagon-back.jpeg",t.RESOURCE+"floor.png",t.RESOURCE+"gloss-panel.png",t.RESOURCE+"gameover.jpg",t.RESOURCE+"logo.jpeg",t.RESOURCE+"1UP.png",t.RESOURCE+"cursor.png"].map(t.checkImage)).then(function(o){t.img_ball=o.shift(),t.img_block=o.shift(),t.img_bonusPanel=o.shift(),t.img_hexagonBack=o.shift(),t.img_floor=o.shift(),t.img_glossPanel=o.shift(),t.img_gameover=o.shift(),t.img_logo=o.shift(),t.img_1up=o.shift(),t.img_cursor=o.shift(),e()})})},t.prototype.run=function(){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.initResources()];case 1:return t.sent(),[4,this.runAfterResourcesLoaded()];case 2:return t.sent(),[2]}})})},t.prototype.runAfterResourcesLoaded=function(){return n(this,void 0,void 0,function(){var e,o,n,r=this;return i(this,function(i){switch(i.label){case 0:return this.blockManager=new a.BlockManager(t.img_block),this.ballManager=new s.BallManager(t.img_ball,function(){return r.blockManager.getBlocks()}),this.scoreRenderer=new u.ScoreRenderer,this.sessionRenderer=new l.SessionRenderer,(e=document.getElementById("gamecanvas")).width=t.WIDTH,e.height=t.HEIGHT,e.style.cursor="url('"+t.img_cursor.src+"'), auto",this.eventListenInit(e),window.performance.now?(console.log("Using high performance timer"),this.getTimestamp=function(){return window.performance.now()}):window.performance.webkitNow?(console.log("Using webkit high performance timer"),this.getTimestamp=function(){return window.performance.webkitNow()}):(console.log("Using low performance timer"),this.getTimestamp=function(){return(new Date).getTime()}),o=e.getContext("2d"),[4,this.initialize()];case 1:return i.sent(),n=function(){r.update(),r.render(o),requestAnimationFrame(n)},requestAnimationFrame(n),[2]}})})},t.prototype.initialize=function(){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.gameState.init(),this.ballManager.init(),[4,this.blockManager.init()];case 1:return t.sent(),this.scoreRenderer.init(),this.sessionRenderer.init(),console.log("Game#initialied()   state: "+this.gameState.state),[2]}})})},t.prototype.update=function(){this.gameState=this.ballManager.update(this.gameState),this.gameState=this.blockManager.update(this.gameState),this.gameState=this.scoreRenderer.update(this.gameState),this.scoreRenderer.setWaveCount(this.gameState.getWaveCount()),this.scoreRenderer.setBallCount(this.ballManager.getBallCount()),this.scoreRenderer.setScore(this.gameState.getScore()),this.gameState.setBallCount(this.ballManager.getBallCount()),this.sessionRenderer.update(this.gameState),--this.runChecker<0&&(this.runChecker=t.RUNCHECK_INTERVAL,console.log("[RUNNING] update()\tstate: "+this.gameState.state))},t.prototype.render=function(e){switch(e.drawImage(t.img_hexagonBack,0,0),this.ballManager.draw(e),this.blockManager.draw(e),e.drawImage(t.img_floor,0,t.FLOOR_Y),this.scoreRenderer.draw(e),this.gameState.state){case c.State.MAIN_MENU:case c.State.GAMEOVER:case c.State.RETURNABLE_TO_MENU:this.sessionRenderer.draw(e,this.gameState)}},t.prototype.eventListenInit=function(e){var o=this;e.addEventListener("mousedown",function(n){n.preventDefault();var i=e.getBoundingClientRect(),s=n.clientX-i.left,a=n.clientY-i.top;switch(console.log("mouse: "+s+", "+a+"   state: "+o.gameState.state),o.gameState.state){case c.State.MAIN_MENU:o.gameState.state=c.State.CLICK_WAIT;break;case c.State.CLICK_WAIT:a<t.FLOOR_Y-(r.Ball.SIZE+25)&&s<t.STATUS_PANEL_X&&(o.gameState.state=c.State.NOW_CLICKED,o.gameState.mousePos.x=s,o.gameState.mousePos.y=a);break;case c.State.RETURNABLE_TO_MENU:o.gameState.state=c.State.MAIN_MENU,o.initialize()}}),document.addEventListener("keyup",function(n){var i=n.key||n.keyCode;32==n.keyCode?o.gameState.state!=c.State.CLICK_WAIT&&(o.gameState.keyPressed_space=!0):"Shift"==i&&((e.style.cursor||"").includes("url")?e.style.cursor="":e.style.cursor="url('"+t.img_cursor.src+"'), auto")})},t.WIDTH=720,t.HEIGHT=540,t.FLOOR_Y=t.HEIGHT-30,t.STATUS_PANEL_X=520,t.RUNCHECK_INTERVAL=120,t.RESOURCE="resources/",t}();e.Game=h},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),r=o(0),s=function(t){function e(e,o,n){var i=t.call(this)||this;return i.vx=0,i.vy=0,i.delay=0,i._isPrepareLaunchPos=!1,i.landed=!1,i.img=e,i.x=o,i.y=n,i.delay=0,i.landed=!0,i}return n(e,t),e.prototype.isLanded=function(){return this.landed},e.prototype.setLanded=function(t){this.landed=t},e.prototype.setVx=function(t){this.vx=t},e.prototype.setVy=function(t){this.vy=t},e.prototype.getVx=function(){return this.vx},e.prototype.getVy=function(){return this.vy},e.prototype.invertVx=function(){this.vx=-this.vx},e.prototype.invertVy=function(){this.vy=-this.vy},e.prototype.setDelay=function(t){this.delay=t},e.prototype.update=function(t){this.delay>0?this.delay--:(this.x+=this.vx*t,this.y+=this.vy*t,this.landed||(this.x<0?(this.vx=-this.vx,this.x=1):this.x+e.SIZE>i.Game.STATUS_PANEL_X&&(this.vx=-this.vx,this.x=i.Game.STATUS_PANEL_X-e.SIZE-1),this.y<0&&(this.vy=-this.vy,this.y=1),Math.trunc(this.y+e.SIZE+1)>i.Game.FLOOR_Y&&(this.landed=!0)))},e.prototype.getBounds=function(){return new r.RectBounds(this.x,this.y,this.x+e.SIZE,this.y+e.SIZE)},e.prototype.draw=function(t){t.drawImage(this.img,Math.trunc(this.x),Math.trunc(this.y))},e.prototype.isPrepareLaunchPos=function(){return this._isPrepareLaunchPos},e.prototype.setisPrepareLaunchPos=function(t){this._isPrepareLaunchPos=t},e.SIZE=16,e.SPEED_FLY=6.2,e.SPEED_ARRANGEMENT=5,e}(o(1).Sprite);e.Ball=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(3),i=o(5),r=o(9),s=o(2),a=o(7),c=o(10),u=o(0),l=o(1),h=function(){function t(e,o){this.anyLanded=!1,this.num_newBall=0,this.img_ball=e,this.getBlocks=o,this.balls=[],t.DEFAULT_START_POS_X||t.DEFAULT_START_POS_Y||(t.DEFAULT_START_POS_X=Math.trunc(s.Game.STATUS_PANEL_X/2),t.DEFAULT_START_POS_Y=s.Game.FLOOR_Y-n.Ball.SIZE),this.preLaunchPos=new c.Point(t.DEFAULT_START_POS_X,t.DEFAULT_START_POS_Y)}return t.prototype.init=function(){this.balls=[],this.num_newBall=0,this.preLaunchPos.x=t.DEFAULT_START_POS_X,this.preLaunchPos.y=t.DEFAULT_START_POS_Y,this.addNewBall(t.DEFAULT_BALL_COUNT),this.visibleBall=this.balls[0],console.log("init() BallManager")},t.prototype.getBallCount=function(){return this.balls.length+this.num_newBall},t.prototype.draw=function(t){this.visibleBall&&this.visibleBall.draw(t),l.Sprite.draw(this.balls,t)},t.prototype.update=function(t){switch(t.state){case a.State.NOW_CLICKED:this.prepareLaunch(t),t.state=a.State.BALL_FLYING;break;case a.State.BALL_FLYING:t=this.ballMove(t)}return t},t.prototype.addNewBall=function(t){for(var e=0;e<t;++e)this.balls.push(new n.Ball(this.img_ball,this.preLaunchPos.x,this.preLaunchPos.y))},t.prototype.prepareLaunch=function(t){console.log("prepareLaunch"),this.anyLanded=!1;var e=t.mousePos.x-n.Ball.SIZE/2,o=t.mousePos.y-n.Ball.SIZE/2,i=Math.atan2(o-this.preLaunchPos.y,e-this.preLaunchPos.x),r=n.Ball.SPEED_FLY*Math.cos(i),s=n.Ball.SPEED_FLY*Math.sin(i);this.balls.forEach(function(t,e){t.setDelay(8*e),t.setLanded(!1),t.setVisible(!0),t.setVx(r),t.setVy(s),t.setisPrepareLaunchPos(!1)})},t.prototype.isPrepareLaunchPosision=function(t){return Math.abs(Math.trunc(t.getX())-this.preLaunchPos.x)<=n.Ball.SPEED_ARRANGEMENT&&t.setX(this.preLaunchPos.x),Math.trunc(t.getX())==this.preLaunchPos.x&&Math.trunc(t.getY())==this.preLaunchPos.y},t.prototype.ballMove=function(e){var o=this,i=!0,r=e.keyPressed_space?t.SCALE_KEY_PRESSED_SPEED:1;return this.balls.forEach(function(t){if(t.isLanded())o.anyLanded||(o.anyLanded=!0,o.visibleBall=t,o.preLaunchPos.x=Math.trunc(t.getX()),o.preLaunchPos.y=s.Game.FLOOR_Y-n.Ball.SIZE),t.setVy(0),t.setY(o.preLaunchPos.y),o.moveToPreLaunchPos(t);else{var a=o.colideJudge(t,e);e.addScore(100*a)}i=i&&t.isPrepareLaunchPos(),t.update(r)}),i&&(console.log("all is PreLaunchPos."),e.state=a.State.BLOCK_DOWN,this.addNewBall(this.num_newBall),this.num_newBall=0),e},t.prototype.moveToPreLaunchPos=function(t){this.isPrepareLaunchPosision(t)?(t.setVx(0),t.setisPrepareLaunchPos(!0),t.setVisible(!1)):Math.trunc(t.getX())<this.preLaunchPos.x?t.setVx(n.Ball.SPEED_ARRANGEMENT):t.setVx(-n.Ball.SPEED_ARRANGEMENT)},t.prototype.colideJudge=function(t,e){for(var o=0,n=new r.EightPointsCollisionState,s=t.getBounds(),a=0,l=this.getBlocks();a<l.length;a++){var h=l[a],p=h.getBounds();s.collision(p)&&(h instanceof i.BonusPanel?(this.num_newBall++,h.vanish(),o+=2,e.bonusPos.push(new c.Point(Math.trunc(h.getX()),Math.trunc(h.getY())))):(n.orAll(u.RectBounds.getEightPointsCollisionState(s,p)),h.addDamage()&&o++))}return this.checkHitBlock(t,n),o},t.prototype.checkHitBlock=function(t,e){var o=e.whereCollisionAt();o!=u.Location.NIL&&this.onHitBlock(t,o)},t.prototype.onHitBlock=function(t,e){switch(e){case u.Location.RIGHT:case u.Location.LEFT:t.invertVx();break;case u.Location.TOP:case u.Location.BOTTOM:t.invertVy();break;case u.Location.RIGHT_BOTTOM:t.getVx()>0&&t.invertVx(),t.setVy(-1*Math.abs(t.getVy()));break;case u.Location.LEFT_BOTTOM:t.getVx()<0&&t.invertVx(),t.setVy(-1*Math.abs(t.getVy()));break;case u.Location.RIGHT_TOP:t.getVx()>0&&t.invertVx(),t.setVy(Math.abs(t.getVy()));break;case u.Location.LEFT_TOP:t.getVx()<0&&t.invertVx(),t.setVy(Math.abs(t.getVy()))}t.update(1)},t.DEFAULT_BALL_COUNT=3,t.DEFAULT_START_POS_X=0,t.DEFAULT_START_POS_Y=0,t.SCALE_KEY_PRESSED_SPEED=1.6,t.MOVE_VALUE_ON_HIT=3,t}();e.BallManager=h},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(6),r=o(0),s=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return n(e,t),e.prototype.soundPlay=function(){},e.prototype.getBounds=function(){return new r.RectBounds(this.x,this.y,this.x+e.WIDTH,this.y+e.HEIGHT)},e.prototype.draw=function(t){t.drawImage(this.img,Math.trunc(this.x),Math.trunc(this.y))},e.WIDTH=40,e}(i.Block);e.BonusPanel=s},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),r=function(t){function e(e,o,n,i){var r=t.call(this)||this;return r.img=e,r.x=o,r.y=n,r.life=i,r}return n(e,t),e.prototype.getBounds=function(){return new i.RectBounds(this.x-1,this.y-1,this.x+e.WIDTH+1,this.y+e.HEIGHT+1)},e.prototype.addDamage=function(){return this.life--,this.life<=0&&(this.vanish(),!0)},e.prototype.soundPlay=function(){},e.prototype.vanish=function(){t.prototype.vanish.call(this),this.soundPlay()},e.prototype.update=function(t){},e.prototype.draw=function(t){t.drawImage(this.img,Math.trunc(this.x),Math.trunc(this.y)),this.drawHP(t)},e.prototype.drawHP=function(t){var o=this.life.toString();t.font="bold "+e.FONT_SIZE+"px sans-serif",t.fillStyle="lightgray";var n=t.measureText(o);t.fillText(o,this.x+e.WIDTH/2-n.width/2,this.y+2*e.HEIGHT/3)},e.WIDTH=70,e.HEIGHT=36,e.FONT_SIZE=20,e}(o(1).Sprite);e.Block=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=o(4),r=o(10);!function(t){t[t.MAIN_MENU=0]="MAIN_MENU",t[t.CLICK_WAIT=1]="CLICK_WAIT",t[t.NOW_CLICKED=2]="NOW_CLICKED",t[t.BALL_FLYING=3]="BALL_FLYING",t[t.BLOCK_DOWN=4]="BLOCK_DOWN",t[t.GAMEOVER=5]="GAMEOVER",t[t.RETURNABLE_TO_MENU=6]="RETURNABLE_TO_MENU"}(n=e.State||(e.State={}));var s=function(){function t(){this.state=n.MAIN_MENU,this.mousePos=new r.Point,this.keyPressed_space=!1,this.bonusPos=[],this.waveCount=0,this.ballCount=0,this.score=0}return t.prototype.init=function(){this.state=n.MAIN_MENU,this.keyPressed_space=!1,this.waveCount=1,this.ballCount=i.BallManager.DEFAULT_BALL_COUNT,this.score=0,this.bonusPos=[]},t.prototype.countUpWave=function(){this.waveCount++},t.prototype.getWaveCount=function(){return this.waveCount},t.prototype.getBallCount=function(){return this.ballCount},t.prototype.setBallCount=function(t){this.ballCount=t},t.prototype.getScore=function(){return this.score},t.prototype.addScore=function(t){this.score+=t},t.prototype.toString=function(){return this.state.toString()+" / "+this.mousePos.toString()},t}();e.GameState=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(0),i=function(){function t(t,e,o,n){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===n&&(n=!1),this.leftTop=t,this.rightTop=e,this.leftBtm=o,this.rightBtm=n}return t.prototype.toString=function(){return"LT: "+this.leftTop+" RT: "+this.rightTop+" LB: "+this.leftBtm+" RB: "+this.rightBtm},t.prototype.orAll=function(t){this.leftTop=this.leftTop||t.leftTop,this.rightTop=this.rightTop||t.rightTop,this.leftBtm=this.leftBtm||t.leftBtm,this.rightBtm=this.rightBtm||t.rightBtm},t.prototype.whereCollisionAt=function(){return this.leftTop&&this.rightTop?n.Location.TOP:this.leftBtm&&this.rightBtm?n.Location.BOTTOM:this.leftTop&&this.leftBtm?n.Location.LEFT:this.rightTop&&this.rightBtm?n.Location.RIGHT:this.leftTop?n.Location.LEFT_TOP:this.rightTop?n.Location.RIGHT_TOP:this.leftBtm?n.Location.LEFT_BOTTOM:this.rightBtm?n.Location.RIGHT_BOTTOM:n.Location.NIL},t}();e.CornerCollisionState=i},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(8),r=o(0),s=function(t){function e(e,o,n,i,r,s,a,c){void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===c&&(c=!1);var u=t.call(this,e,o,n,i)||this;return u.top=!1,u.bottom=!1,u.left=!1,u.right=!1,u.top=r,u.bottom=s,u.left=a,u.right=c,u}return n(e,t),e.prototype.orAll=function(e){t.prototype.orAll.call(this,e),this.top=this.top||e.top,this.bottom=this.bottom||e.bottom,this.left=this.left||e.left,this.right=this.right||e.right},e.prototype.whereCollisionAt=function(){var e=t.prototype.whereCollisionAt.call(this);switch(e){case r.Location.LEFT_BOTTOM:this.left&&this.bottom||(this.left?e=r.Location.LEFT:this.bottom&&(e=r.Location.BOTTOM));break;case r.Location.RIGHT_BOTTOM:this.right&&this.bottom||(this.right?e=r.Location.RIGHT:this.bottom&&(e=r.Location.BOTTOM));break;case r.Location.LEFT_TOP:this.left&&this.top||(this.left?e=r.Location.LEFT:this.top&&(e=r.Location.TOP));break;case r.Location.RIGHT_TOP:this.right&&this.top||(this.right?e=r.Location.RIGHT:this.top&&(e=r.Location.TOP))}return e},e}(i.CornerCollisionState);e.EightPointsCollisionState=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}}();e.Point=n},function(t,e,o){"use strict";var n=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new o(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(4),s=o(6),a=o(5),c=o(2),u=o(7),l=o(1),h=function(){function t(t){this.src_img=t,this.blocks=[],this.blockDownSpeed=0,this.delay=0,this.movedDist=0}return t.prototype.initResources=function(){var e=this;return new Promise(function(o){for(var n=0;n<t.NUM_BLOCK_COLOR;n++){var i=document.createElement("canvas");i.width=s.Block.WIDTH,i.height=s.Block.HEIGHT;var r=i.getContext("2d");r.drawImage(e.src_img,0,0),r.globalCompositeOperation="overlay",0==n?r.fillStyle="rgb(180, 0, 0)":1==n?r.fillStyle="rgb(0, 180, 0)":2==n?r.fillStyle="rgb(0, 0, 220)":3==n&&(r.fillStyle="rgb(150, 150, -20)"),r.fillRect(0,0,s.Block.WIDTH,s.Block.HEIGHT);var a=new Image;a.src=i.toDataURL(),t.img_blocks.push(a),o()}})},t.prototype.init=function(){return n(this,void 0,void 0,function(){var e,o,n;return i(this,function(i){switch(i.label){case 0:return t.img_blocks.length?[3,2]:[4,this.initResources()];case 1:i.sent(),i.label=2;case 2:for(this.blocks=[],o=0;o<t.NUM_BLOCK_VERTICAL;++o)n=t.OFFSET_Y+o*(s.Block.HEIGHT+t.MARGIN_Y),(e=this.blocks).push.apply(e,this.createHorizontalBlockArray(n,this.calcNUM_VOID(),t.BONUS_PROBABILITY+20,r.BallManager.DEFAULT_BALL_COUNT));return this.initDown(r.BallManager.DEFAULT_BALL_COUNT),console.log("init() BlockManager : num_blocks_count = "+this.blocks.length),[2]}})})},t.prototype.update=function(t){switch(t.state){case u.State.BLOCK_DOWN:t=this.blockDown(t)}return t},t.prototype.draw=function(t){l.Sprite.draw(this.blocks,t)},t.prototype.getBlocks=function(){return this.blocks},t.prototype.blockDown=function(e){var o=this;return this.delay>0?this.delay--:Math.trunc(this.movedDist)>=s.Block.HEIGHT+t.MARGIN_Y?(this.initDown(e.getBallCount()),e.state=u.State.CLICK_WAIT,e.countUpWave(),e.addScore(e.getWaveCount()%10==0?300:e.getWaveCount()%5==0?100:50)):(this.blocks.forEach(function(t){if(t.addY(o.blockDownSpeed),!(t instanceof a.BonusPanel)&&t.getY()+s.Block.HEIGHT>c.Game.FLOOR_Y)return e.state=u.State.GAMEOVER,e}),this.movedDist+=this.blockDownSpeed,this.blockDownSpeed-=t.VALUE_DOWN_SPEED_SLOW,this.blockDownSpeed<0&&(this.blockDownSpeed=.25)),e},t.prototype.initDown=function(e){var o;this.blockDownSpeed=t.DEFAULT_BLOCK_DOWN_SPEED,this.delay=15,this.movedDist=0,(o=this.blocks).push.apply(o,this.createHorizontalHideArray(this.calcNUM_VOID(),e))},t.prototype.calcNUM_VOID=function(){return this.blocks.length<11?t.NUM_VOID-1:Math.trunc(10*Math.random())<2?t.NUM_VOID+1:t.NUM_VOID},t.prototype.createHorizontalHideArray=function(e,o){return this.createHorizontalBlockArray(-1*(s.Block.HEIGHT+t.MARGIN_Y),this.calcNUM_VOID(),t.BONUS_PROBABILITY,o)},t.prototype.createHorizontalBlockArray=function(e,o,n,i){if(o>t.NUM_BLOCK_HORIZONTAL)throw new Error('IllegalArgumentException("num_void is larger than NUM_BLOCK_HORIZONTAL")');for(var r=[],u=[],l=-1,h=[],p=void 0,_=0;_<o;++_){do{p=Math.trunc(Math.random()*t.NUM_BLOCK_HORIZONTAL)}while(1==u[p]);u[p]=!0,h.push(p)}Math.trunc(100*Math.random())<n&&(l=h[Math.trunc(Math.random()*h.length)]);for(_=0;_<t.NUM_BLOCK_HORIZONTAL;++_)if(u[_]){if(_==l){var f=Math.trunc(t.OFFSET_X+_*(s.Block.WIDTH+t.MARGIN_X)+(s.Block.WIDTH-a.BonusPanel.WIDTH)/2);r.push(new a.BonusPanel(c.Game.img_bonusPanel,f,e,1))}}else{f=t.OFFSET_X+_*(s.Block.WIDTH+t.MARGIN_X);var T=1+i+Math.trunc(Math.random()*i);r.push(new s.Block(t.img_blocks[Math.trunc(Math.random()*t.NUM_BLOCK_COLOR)],f,e,T))}return r},t.NUM_BLOCK_COLOR=4,t.MARGIN_X=1,t.MARGIN_Y=1,t.OFFSET_X=40,t.OFFSET_Y=0,t.NUM_BLOCK_HORIZONTAL=6,t.NUM_BLOCK_VERTICAL=5,t.DEFAULT_BLOCK_DOWN_SPEED=4.2,t.VALUE_DOWN_SPEED_SLOW=.22,t.BONUS_PROBABILITY=70,t.NUM_VOID=3,t.img_blocks=[],t}();e.BlockManager=h},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(3),r=o(6),s=o(5),a=o(2),c=o(1),u=function(t){function e(e,o,n){var i=t.call(this)||this;return i.oparity=1,i.img=e,i.x=o,i.y=n,i.oparity=1,i}return n(e,t),e.prototype.update=function(t){this.y-=e.Y_MOVE_VALUE,this.oparity-=e.OPACITY_SUBTRACT_VALUE,this.oparity<=0&&this.vanish()},e.prototype.draw=function(t){t.drawImage(this.img,Math.trunc(this.x),Math.trunc(this.y))},e.OPACITY_SUBTRACT_VALUE=.03,e.Y_MOVE_VALUE=.4,e}(c.Sprite),l=function(){function t(){this.ballCount=0,this.waveCount=1,this.score=0,this.bonusPoses=[],this.init(),t.WIDTH=a.Game.WIDTH-a.Game.STATUS_PANEL_X+10,t.HEIGHT=a.Game.HEIGHT+40}return t.prototype.init=function(){this.ballCount=0,this.waveCount=1,this.score=0,this.bonusPoses=[],console.log("init() ScoreRenderer")},t.prototype.update=function(e){c.Sprite.update(this.bonusPoses);for(var o=e.bonusPos;o.length;){var n=o.shift();n&&this.bonusPoses.push(new u(a.Game.img_1up,n.x-t.WIDTH_DIFF,n.y))}return e},t.prototype.draw=function(e){c.Sprite.draw(this.bonusPoses,e),e.drawImage(a.Game.img_glossPanel,a.Game.STATUS_PANEL_X,0,t.WIDTH,t.HEIGHT),e.fillStyle="white",e.font="bold 20px sans-serif",e.fillText("WAVE:",a.Game.STATUS_PANEL_X+20,t.BOTTOM_Y_STRING_WAVE),e.font="bold 32px sans-serif";var o=this.waveCount.toString(),n=e.measureText(o),r=a.Game.STATUS_PANEL_X+t.WIDTH/2-n.width/2,s=t.BOTTOM_Y_STRING_WAVE+30;e.fillText(o,r,s),e.font="bold 20px sans-serif",e.fillText("BALL:",a.Game.STATUS_PANEL_X+20,t.BOTTOM_Y_STRING_BALL),e.drawImage(a.Game.img_ball,a.Game.STATUS_PANEL_X+t.WIDTH/2-i.Ball.SIZE/2,t.BOTTOM_Y_STRING_BALL-i.Ball.SIZE),e.font="bold 32px sans-serif";o=this.ballCount.toString(),n=e.measureText(o),r=a.Game.STATUS_PANEL_X+t.WIDTH/2-n.width/2,s=t.BOTTOM_Y_STRING_BALL+30;e.fillText(o,r,s),e.font="bold 20px sans-serif",e.fillText("SCORE:",a.Game.STATUS_PANEL_X+20,t.BOTTOM_Y_STRING_SCORE),e.font="bold 32px sans-serif";o=this.score.toString(),n=e.measureText(o),r=a.Game.STATUS_PANEL_X+t.WIDTH/2-n.width/2,s=t.BOTTOM_Y_STRING_SCORE+30;e.fillText(o,r,s)},t.prototype.getBallCount=function(){return this.ballCount},t.prototype.setBallCount=function(t){this.ballCount=t},t.prototype.getWaveCount=function(){return this.waveCount},t.prototype.setWaveCount=function(t){this.waveCount=t},t.prototype.getScore=function(){return this.score},t.prototype.setScore=function(t){this.score=t},t.WIDTH_DIFF=r.Block.WIDTH-s.BonusPanel.WIDTH,t.WIDTH=0,t.HEIGHT=0,t.BOTTOM_Y_STRING_WAVE=30,t.BOTTOM_Y_STRING_BALL=160,t.BOTTOM_Y_STRING_SCORE=290,t}();e.ScoreRenderer=l},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(2),i=o(7),r=function(){function t(){this.opacity=t.DEFAULT_OPACITY,this.img_y=t.FIRST_IMG_Y,this.delay=t.DELAY,this.text_y=t.TEXT_Y,this.isText_y_up=!1,this.init()}return t.prototype.init=function(){this.opacity=t.DEFAULT_OPACITY,this.img_y=t.FIRST_IMG_Y,this.delay=t.DELAY,this.text_y=t.TEXT_Y,this.isText_y_up=!1,console.log("init() SessionRenderer")},t.prototype.update=function(e){switch(e.state){case i.State.MAIN_MENU:this.textMove();break;case i.State.GAMEOVER:this.img_y<t.END_IMG_Y?(this.img_y+=t.IMG_VY,this.opacity+=t.FADE_IN_SPEED,this.opacity>1&&(this.opacity=1)):this.delay>0?--this.delay:(console.log("---RETURNABLE"),e.state=i.State.RETURNABLE_TO_MENU)}return e},t.prototype.draw=function(t,e){switch(e.state){case i.State.MAIN_MENU:this.drawMainMenu(t);break;case i.State.GAMEOVER:this.drawGameOver(t);break;case i.State.RETURNABLE_TO_MENU:this.drawGameOver(t),this.drawScore(t,e.getScore())}},t.prototype.textMove=function(){this.isText_y_up?this.text_y>t.MIN_TOP_TXET_Y?this.text_y-=t.VAULE_TEXT_Y_ADD:this.isText_y_up=!1:this.text_y<t.MAX_BOTTOM_TEXT_Y?this.text_y+=t.VAULE_TEXT_Y_ADD:this.isText_y_up=!0},t.prototype.drawScore=function(t,e){t.font="bold 20px sans-serif",t.fillStyle="white",t.fillText("Click to MAIN-MENU...",420,520);var o="YOUR SCORE";t.font="bold 20px sans-serif";var i=t.measureText(o);t.fillText(o,n.Game.WIDTH/2-i.width/2,370);o=e.toString();t.font="bold 75px sans-serif";i=t.measureText(o);t.fillText(o,n.Game.WIDTH/2-i.width/2,460)},t.prototype.drawMainMenu=function(e){e.drawImage(n.Game.img_logo,0,0),e.font="bold 20px sans-serif",e.fillStyle="white";var o=e.measureText(t.TEXT_MENU),i=n.Game.WIDTH/2-o.width/2;e.fillText(t.TEXT_MENU,i,this.text_y)},t.prototype.drawGameOver=function(t){t.save(),t.globalAlpha=this.opacity,t.drawImage(n.Game.img_gameover,0,this.img_y),t.restore()},t.DEFAULT_OPACITY=.2,t.FADE_IN_SPEED=.005,t.FIRST_IMG_Y=-80,t.END_IMG_Y=-55,t.IMG_VY=.14,t.DELAY=70,t.TEXT_Y=460,t.MIN_TOP_TXET_Y=454,t.MAX_BOTTOM_TEXT_Y=t.TEXT_Y,t.VAULE_TEXT_Y_ADD=.14,t.TEXT_MENU="Click to start",t}();e.SessionRenderer=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(15).Game.main()},function(t,e,o){"use strict";function n(t){for(var o in t)e.hasOwnProperty(o)||(e[o]=t[o])}Object.defineProperty(e,"__esModule",{value:!0}),n(o(1)),n(o(3)),n(o(4)),n(o(6)),n(o(5)),n(o(11)),n(o(0)),n(o(8)),n(o(9)),n(o(12)),n(o(13)),n(o(2))}]);
//# sourceMappingURL=bundle.js.map